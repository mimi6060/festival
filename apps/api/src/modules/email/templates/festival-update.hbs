{{!--
  Festival Update Email Template
  Sent for important festival announcements and updates

  Variables:
  - userName: User's first name
  - userEmail: User's email address
  - festivalName: Name of the festival
  - festivalUrl: Festival website URL
  - updateType: Type of update (lineup, schedule, venue, general, emergency, cancellation)
  - updateTitle: Title of the update
  - updateSummary: Short summary of the update
  - updateContent: Full HTML content of the update
  - updateDate: Date of the update
  - urgency: Urgency level (low, medium, high, critical)
  - changes: Array of specific changes (optional)
    - type: Change type (added, removed, modified, cancelled)
    - title: Change title
    - description: Change description
    - oldValue: Previous value (for modifications)
    - newValue: New value (for modifications)
  - affectedDates: Array of affected dates (optional)
  - actionRequired: Boolean indicating if action is required
  - actionUrl: URL for required action
  - actionText: Text for action button
  - relatedLinks: Array of related links (optional)
    - text: Link text
    - url: Link URL
  - contactInfo: Contact information for questions
  - ticketUrl: Link to user's tickets
  - lang_fr: Boolean for French language
  - primaryColor: Brand primary color
  - secondaryColor: Brand secondary color
--}}

{{#if lang_fr}}
<!-- French Version -->
{{#ifEquals urgency 'critical'}}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px; padding: 20px; background-color: #fef2f2; border-radius: 8px; border: 2px solid #dc2626;">
  <tr>
    <td align="center">
      <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #dc2626; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">
        &#128680; Information urgente &#128680;
      </p>
    </td>
  </tr>
</table>
{{/ifEquals}}

<h1 style="margin: 0 0 20px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 28px; font-weight: 700; color: #1a1a2e; line-height: 36px;">
  {{updateTitle}}
</h1>

<p style="margin: 0 0 25px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  Bonjour <strong>{{userName}}</strong>,<br><br>
  {{updateSummary}}
</p>

<!-- Update Type Badge -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px;">
  <tr>
    <td>
      <span style="display: inline-block; padding: 6px 14px; background-color: {{#ifEquals updateType 'lineup'}}#dbeafe{{else ifEquals updateType 'schedule'}}#fef3c7{{else ifEquals updateType 'venue'}}#d1fae5{{else ifEquals updateType 'emergency'}}#fee2e2{{else ifEquals updateType 'cancellation'}}#fecaca{{else}}#f3f4f6{{/ifEquals}}; color: {{#ifEquals updateType 'lineup'}}#1e40af{{else ifEquals updateType 'schedule'}}#92400e{{else ifEquals updateType 'venue'}}#065f46{{else ifEquals updateType 'emergency'}}#991b1b{{else ifEquals updateType 'cancellation'}}#991b1b{{else}}#374151{{/ifEquals}}; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border-radius: 20px;">
        {{#ifEquals updateType 'lineup'}}&#127926; Programmation{{else ifEquals updateType 'schedule'}}&#128197; Horaires{{else ifEquals updateType 'venue'}}&#128205; Lieu{{else ifEquals updateType 'emergency'}}&#9888;&#65039; Urgence{{else ifEquals updateType 'cancellation'}}&#10060; Annulation{{else}}&#128172; Information{{/ifEquals}}
      </span>
      <span style="margin-left: 10px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #8c8c8c;">
        {{formatDate updateDate 'long'}}
      </span>
    </td>
  </tr>
</table>

<!-- Main Content -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px; padding: 25px; background-color: #f8f9fa; border-radius: 12px; border-left: 4px solid {{primaryColor}};">
  <tr>
    <td>
      <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
        {{{updateContent}}}
      </div>
    </td>
  </tr>
</table>

<!-- Changes List -->
{{#if changes}}
<h2 style="margin: 30px 0 15px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 20px; font-weight: 600; color: #1a1a2e;">
  &#128221; Details des changements
</h2>

<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px;">
  {{#each changes}}
  <tr>
    <td style="padding: 15px; background-color: {{#ifEquals type 'added'}}#f0fdf4{{else ifEquals type 'removed'}}#fef2f2{{else ifEquals type 'cancelled'}}#fef2f2{{else}}#fffbeb{{/ifEquals}}; border-radius: 8px; margin-bottom: 10px;">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td style="width: 30px; vertical-align: top;">
            <span style="font-size: 20px;">
              {{#ifEquals type 'added'}}&#10133;{{else ifEquals type 'removed'}}&#10134;{{else ifEquals type 'cancelled'}}&#10060;{{else}}&#128260;{{/ifEquals}}
            </span>
          </td>
          <td>
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
              {{title}}
            </p>
            {{#if description}}
            <p style="margin: 5px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              {{description}}
            </p>
            {{/if}}
            {{#if oldValue}}
            <p style="margin: 8px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; color: #8c8c8c;">
              <span style="text-decoration: line-through;">{{oldValue}}</span>
              &#8594;
              <span style="color: {{../primaryColor}}; font-weight: 500;">{{newValue}}</span>
            </p>
            {{/if}}
          </td>
        </tr>
      </table>
    </td>
  </tr>
  {{#unless @last}}
  <tr><td style="height: 10px;"></td></tr>
  {{/unless}}
  {{/each}}
</table>
{{/if}}

<!-- Affected Dates -->
{{#if affectedDates}}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px; padding: 20px; background-color: #fef3c7; border-radius: 8px; border: 1px solid #fbbf24;">
  <tr>
    <td>
      <p style="margin: 0 0 10px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #92400e; font-weight: 600;">
        &#128197; Dates concernees :
      </p>
      <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #92400e;">
        {{#each affectedDates}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
      </p>
    </td>
  </tr>
</table>
{{/if}}

<!-- Action Required -->
{{#if actionRequired}}
{{> alert
  type_error=true
  icon="&#9888;&#65039;"
  title="Action requise"
  message="Cette mise a jour necessite une action de votre part. Veuillez cliquer sur le bouton ci-dessous pour plus de details."
}}

{{> button
  url=actionUrl
  text=actionText
  align="center"
  buttonColor="#dc2626"
}}
{{else}}
{{> button
  url=festivalUrl
  text="Voir tous les details"
  align="center"
  showFallback=true
}}
{{/if}}

<!-- Related Links -->
{{#if relatedLinks}}
<h2 style="margin: 30px 0 15px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 600; color: #1a1a2e;">
  &#128279; Liens utiles
</h2>

<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px;">
  {{#each relatedLinks}}
  <tr>
    <td style="padding: 8px 0;">
      <a href="{{url}}" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: {{../primaryColor}}; text-decoration: none;">
        &#8594; {{text}}
      </a>
    </td>
  </tr>
  {{/each}}
</table>
{{/if}}

<!-- Quick Links -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0;">
  <tr>
    <td align="center">
      <table border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td style="padding: 0 8px;">
            <a href="{{ticketUrl}}" style="display: inline-block; padding: 10px 18px; background-color: #f8f9fa; color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; font-weight: 500; text-decoration: none; border-radius: 6px; border: 1px solid #e0e0e0;">
              &#127915; Mes billets
            </a>
          </td>
          <td style="padding: 0 8px;">
            <a href="{{festivalUrl}}/programme" style="display: inline-block; padding: 10px 18px; background-color: #f8f9fa; color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; font-weight: 500; text-decoration: none; border-radius: 6px; border: 1px solid #e0e0e0;">
              &#127926; Programme
            </a>
          </td>
          <td style="padding: 0 8px;">
            <a href="{{festivalUrl}}/faq" style="display: inline-block; padding: 10px 18px; background-color: #f8f9fa; color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; font-weight: 500; text-decoration: none; border-radius: 6px; border: 1px solid #e0e0e0;">
              &#10067; FAQ
            </a>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<!-- Contact Info -->
{{#if contactInfo}}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
  <tr>
    <td>
      <p style="margin: 0 0 10px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666; font-weight: 600;">
        &#128172; Des questions ?
      </p>
      <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
        {{{contactInfo}}}
      </p>
    </td>
  </tr>
</table>
{{/if}}

<p style="margin: 30px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  Merci de votre comprehension et a bientot !
</p>

<p style="margin: 20px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
  L'equipe {{festivalName}}
</p>

{{else}}
<!-- English Version -->
{{#ifEquals urgency 'critical'}}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px; padding: 20px; background-color: #fef2f2; border-radius: 8px; border: 2px solid #dc2626;">
  <tr>
    <td align="center">
      <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #dc2626; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">
        &#128680; Urgent Notice &#128680;
      </p>
    </td>
  </tr>
</table>
{{/ifEquals}}

<h1 style="margin: 0 0 20px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 28px; font-weight: 700; color: #1a1a2e; line-height: 36px;">
  {{updateTitle}}
</h1>

<p style="margin: 0 0 25px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  Hello <strong>{{userName}}</strong>,<br><br>
  {{updateSummary}}
</p>

<!-- Update Type Badge -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px;">
  <tr>
    <td>
      <span style="display: inline-block; padding: 6px 14px; background-color: {{#ifEquals updateType 'lineup'}}#dbeafe{{else ifEquals updateType 'schedule'}}#fef3c7{{else ifEquals updateType 'venue'}}#d1fae5{{else ifEquals updateType 'emergency'}}#fee2e2{{else ifEquals updateType 'cancellation'}}#fecaca{{else}}#f3f4f6{{/ifEquals}}; color: {{#ifEquals updateType 'lineup'}}#1e40af{{else ifEquals updateType 'schedule'}}#92400e{{else ifEquals updateType 'venue'}}#065f46{{else ifEquals updateType 'emergency'}}#991b1b{{else ifEquals updateType 'cancellation'}}#991b1b{{else}}#374151{{/ifEquals}}; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border-radius: 20px;">
        {{#ifEquals updateType 'lineup'}}&#127926; Lineup{{else ifEquals updateType 'schedule'}}&#128197; Schedule{{else ifEquals updateType 'venue'}}&#128205; Venue{{else ifEquals updateType 'emergency'}}&#9888;&#65039; Emergency{{else ifEquals updateType 'cancellation'}}&#10060; Cancellation{{else}}&#128172; Update{{/ifEquals}}
      </span>
      <span style="margin-left: 10px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #8c8c8c;">
        {{formatDate updateDate 'long'}}
      </span>
    </td>
  </tr>
</table>

<!-- Main Content -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px; padding: 25px; background-color: #f8f9fa; border-radius: 12px; border-left: 4px solid {{primaryColor}};">
  <tr>
    <td>
      <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
        {{{updateContent}}}
      </div>
    </td>
  </tr>
</table>

<!-- Changes List -->
{{#if changes}}
<h2 style="margin: 30px 0 15px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 20px; font-weight: 600; color: #1a1a2e;">
  &#128221; Change details
</h2>

<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px;">
  {{#each changes}}
  <tr>
    <td style="padding: 15px; background-color: {{#ifEquals type 'added'}}#f0fdf4{{else ifEquals type 'removed'}}#fef2f2{{else ifEquals type 'cancelled'}}#fef2f2{{else}}#fffbeb{{/ifEquals}}; border-radius: 8px; margin-bottom: 10px;">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td style="width: 30px; vertical-align: top;">
            <span style="font-size: 20px;">
              {{#ifEquals type 'added'}}&#10133;{{else ifEquals type 'removed'}}&#10134;{{else ifEquals type 'cancelled'}}&#10060;{{else}}&#128260;{{/ifEquals}}
            </span>
          </td>
          <td>
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
              {{title}}
            </p>
            {{#if description}}
            <p style="margin: 5px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              {{description}}
            </p>
            {{/if}}
            {{#if oldValue}}
            <p style="margin: 8px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; color: #8c8c8c;">
              <span style="text-decoration: line-through;">{{oldValue}}</span>
              &#8594;
              <span style="color: {{../primaryColor}}; font-weight: 500;">{{newValue}}</span>
            </p>
            {{/if}}
          </td>
        </tr>
      </table>
    </td>
  </tr>
  {{#unless @last}}
  <tr><td style="height: 10px;"></td></tr>
  {{/unless}}
  {{/each}}
</table>
{{/if}}

<!-- Affected Dates -->
{{#if affectedDates}}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px; padding: 20px; background-color: #fef3c7; border-radius: 8px; border: 1px solid #fbbf24;">
  <tr>
    <td>
      <p style="margin: 0 0 10px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #92400e; font-weight: 600;">
        &#128197; Affected dates:
      </p>
      <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #92400e;">
        {{#each affectedDates}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
      </p>
    </td>
  </tr>
</table>
{{/if}}

<!-- Action Required -->
{{#if actionRequired}}
{{> alert
  type_error=true
  icon="&#9888;&#65039;"
  title="Action required"
  message="This update requires action on your part. Please click the button below for more details."
}}

{{> button
  url=actionUrl
  text=actionText
  align="center"
  buttonColor="#dc2626"
}}
{{else}}
{{> button
  url=festivalUrl
  text="View all details"
  align="center"
  showFallback=true
}}
{{/if}}

<!-- Related Links -->
{{#if relatedLinks}}
<h2 style="margin: 30px 0 15px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 600; color: #1a1a2e;">
  &#128279; Useful links
</h2>

<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 25px;">
  {{#each relatedLinks}}
  <tr>
    <td style="padding: 8px 0;">
      <a href="{{url}}" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: {{../primaryColor}}; text-decoration: none;">
        &#8594; {{text}}
      </a>
    </td>
  </tr>
  {{/each}}
</table>
{{/if}}

<!-- Quick Links -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0;">
  <tr>
    <td align="center">
      <table border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td style="padding: 0 8px;">
            <a href="{{ticketUrl}}" style="display: inline-block; padding: 10px 18px; background-color: #f8f9fa; color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; font-weight: 500; text-decoration: none; border-radius: 6px; border: 1px solid #e0e0e0;">
              &#127915; My tickets
            </a>
          </td>
          <td style="padding: 0 8px;">
            <a href="{{festivalUrl}}/lineup" style="display: inline-block; padding: 10px 18px; background-color: #f8f9fa; color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; font-weight: 500; text-decoration: none; border-radius: 6px; border: 1px solid #e0e0e0;">
              &#127926; Lineup
            </a>
          </td>
          <td style="padding: 0 8px;">
            <a href="{{festivalUrl}}/faq" style="display: inline-block; padding: 10px 18px; background-color: #f8f9fa; color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 13px; font-weight: 500; text-decoration: none; border-radius: 6px; border: 1px solid #e0e0e0;">
              &#10067; FAQ
            </a>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<!-- Contact Info -->
{{#if contactInfo}}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
  <tr>
    <td>
      <p style="margin: 0 0 10px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666; font-weight: 600;">
        &#128172; Questions?
      </p>
      <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
        {{{contactInfo}}}
      </p>
    </td>
  </tr>
</table>
{{/if}}

<p style="margin: 30px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  Thank you for your understanding and see you soon!
</p>

<p style="margin: 20px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
  The {{festivalName}} Team
</p>
{{/if}}
