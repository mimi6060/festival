{{!--
  Ticket Purchase Confirmation Email Template
  Sent after successful ticket purchase

  Variables:
  - userName: User's first name
  - userEmail: User's email address
  - festivalName: Name of the festival
  - festivalUrl: Festival website URL
  - ticketUrl: Link to view/download ticket
  - orderReference: Order reference number
  - orderDate: Purchase date
  - tickets: Array of purchased tickets
    - ticketType: Type/category of ticket
    - quantity: Number of tickets
    - unitPrice: Price per ticket
    - totalPrice: Total price for this line
  - subtotal: Order subtotal
  - fees: Service fees
  - totalAmount: Total order amount
  - currency: Currency code (EUR, USD, etc.)
  - paymentMethod: Payment method used
  - eventDate: Festival date(s)
  - venueName: Venue name
  - venueAddress: Venue address
  - qrCodeUrl: QR code image URL
  - lang_fr: Boolean for French language
  - primaryColor: Brand primary color
  - secondaryColor: Brand secondary color
--}}

{{#if lang_fr}}
<!-- French Version -->
<h1 style="margin: 0 0 20px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 28px; font-weight: 700; color: #1a1a2e; line-height: 36px;">
  Merci pour votre achat !
</h1>

<p style="margin: 0 0 25px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  Bonjour <strong>{{userName}}</strong>,<br><br>
  Votre commande pour <strong>{{festivalName}}</strong> a ete confirmee ! Voici le recapitulatif de votre achat.
</p>

<!-- Success Alert -->
{{> alert
  type_success=true
  icon="&#10003;"
  title="Paiement confirme"
  message="Votre paiement a ete traite avec succes. Vos billets sont prets !"
}}

<!-- Order Summary Card -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0; background-color: #f8f9fa; border-radius: 12px; overflow: hidden;">
  <!-- Order Header -->
  <tr>
    <td style="padding: 20px; background: linear-gradient(135deg, {{primaryColor}} 0%, {{secondaryColor}} 100%);">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td>
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; color: rgba(255,255,255,0.8); text-transform: uppercase; letter-spacing: 1px;">
              Commande
            </p>
            <p style="margin: 5px 0 0 0; font-family: 'Courier New', monospace; font-size: 18px; color: #ffffff; font-weight: 700; letter-spacing: 1px;">
              #{{orderReference}}
            </p>
          </td>
          <td align="right">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: rgba(255,255,255,0.9);">
              {{formatDate orderDate 'long'}}
            </p>
          </td>
        </tr>
      </table>
    </td>
  </tr>

  <!-- Tickets List -->
  <tr>
    <td style="padding: 20px;">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td style="padding-bottom: 15px; border-bottom: 1px solid #e0e0e0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; color: #8c8c8c; text-transform: uppercase; letter-spacing: 0.5px;">
              Billets achetes
            </p>
          </td>
        </tr>
        {{#each tickets}}
        <tr>
          <td style="padding: 15px 0; {{#unless @last}}border-bottom: 1px solid #e0e0e0;{{/unless}}">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td>
                  <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
                    {{ticketType}}
                  </p>
                  <p style="margin: 4px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
                    {{quantity}} x {{formatCurrency unitPrice ../currency}}
                  </p>
                </td>
                <td align="right" style="vertical-align: middle;">
                  <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
                    {{formatCurrency totalPrice ../currency}}
                  </p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {{/each}}
      </table>
    </td>
  </tr>

  <!-- Price Summary -->
  <tr>
    <td style="padding: 0 20px 20px 20px;">
      <table border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: #ffffff; border-radius: 8px; padding: 15px;">
        <tr>
          <td style="padding: 8px 15px;">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
                  Sous-total
                </td>
                <td align="right" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #1a1a2e;">
                  {{formatCurrency subtotal currency}}
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {{#if fees}}
        <tr>
          <td style="padding: 8px 15px;">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
                  Frais de service
                </td>
                <td align="right" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #1a1a2e;">
                  {{formatCurrency fees currency}}
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {{/if}}
        <tr>
          <td style="padding: 12px 15px; border-top: 2px solid #e0e0e0;">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 18px; color: #1a1a2e; font-weight: 700;">
                  Total
                </td>
                <td align="right" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 18px; color: {{primaryColor}}; font-weight: 700;">
                  {{formatCurrency totalAmount currency}}
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<!-- Ticket Card -->
{{> ticket-card
  ticketType=mainTicketType
  festivalName=festivalName
  quantity=totalQuantity
  eventDate=eventDateFormatted
  venueName=venueName
  venueAddress=venueAddress
  orderReference=orderReference
  qrCodeUrl=qrCodeUrl
  lang_fr=true
}}

<!-- CTA Button -->
{{> button
  url=ticketUrl
  text="Voir mes billets"
  align="center"
  showFallback=true
}}

<!-- Info Box: What's Next -->
{{> info-box
  title="Prochaines etapes"
  icon="&#128161;"
  content="<ul style='margin: 0; padding-left: 20px;'>
    <li style='margin-bottom: 8px;'>Telechargez vos billets depuis votre espace personnel</li>
    <li style='margin-bottom: 8px;'>Presentez le QR code sur votre telephone ou imprime a l'entree</li>
    <li style='margin-bottom: 8px;'>Activez votre compte cashless pour payer sur place</li>
    <li>Consultez le programme et planifiez votre journee</li>
  </ul>"
}}

<!-- Event Details -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
  <tr>
    <td>
      <h3 style="margin: 0 0 15px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; font-weight: 600; color: #1a1a2e;">
        &#128197; Informations pratiques
      </h3>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td style="padding: 8px 0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              <strong>Date :</strong> {{eventDateFormatted}}
            </p>
          </td>
        </tr>
        <tr>
          <td style="padding: 8px 0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              <strong>Lieu :</strong> {{venueName}}{{#if venueAddress}}, {{venueAddress}}{{/if}}
            </p>
          </td>
        </tr>
        <tr>
          <td style="padding: 8px 0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              <strong>Paiement :</strong> {{paymentMethod}}
            </p>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<p style="margin: 30px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  On a hate de vous accueillir !
</p>

<p style="margin: 20px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
  L'equipe {{festivalName}}
</p>

{{else}}
<!-- English Version -->
<h1 style="margin: 0 0 20px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 28px; font-weight: 700; color: #1a1a2e; line-height: 36px;">
  Thank you for your purchase!
</h1>

<p style="margin: 0 0 25px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  Hello <strong>{{userName}}</strong>,<br><br>
  Your order for <strong>{{festivalName}}</strong> has been confirmed! Here's your purchase summary.
</p>

<!-- Success Alert -->
{{> alert
  type_success=true
  icon="&#10003;"
  title="Payment confirmed"
  message="Your payment was processed successfully. Your tickets are ready!"
}}

<!-- Order Summary Card -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0; background-color: #f8f9fa; border-radius: 12px; overflow: hidden;">
  <!-- Order Header -->
  <tr>
    <td style="padding: 20px; background: linear-gradient(135deg, {{primaryColor}} 0%, {{secondaryColor}} 100%);">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td>
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; color: rgba(255,255,255,0.8); text-transform: uppercase; letter-spacing: 1px;">
              Order
            </p>
            <p style="margin: 5px 0 0 0; font-family: 'Courier New', monospace; font-size: 18px; color: #ffffff; font-weight: 700; letter-spacing: 1px;">
              #{{orderReference}}
            </p>
          </td>
          <td align="right">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: rgba(255,255,255,0.9);">
              {{formatDate orderDate 'long'}}
            </p>
          </td>
        </tr>
      </table>
    </td>
  </tr>

  <!-- Tickets List -->
  <tr>
    <td style="padding: 20px;">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td style="padding-bottom: 15px; border-bottom: 1px solid #e0e0e0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 12px; color: #8c8c8c; text-transform: uppercase; letter-spacing: 0.5px;">
              Purchased tickets
            </p>
          </td>
        </tr>
        {{#each tickets}}
        <tr>
          <td style="padding: 15px 0; {{#unless @last}}border-bottom: 1px solid #e0e0e0;{{/unless}}">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td>
                  <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
                    {{ticketType}}
                  </p>
                  <p style="margin: 4px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
                    {{quantity}} x {{formatCurrency unitPrice ../currency}}
                  </p>
                </td>
                <td align="right" style="vertical-align: middle;">
                  <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
                    {{formatCurrency totalPrice ../currency}}
                  </p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {{/each}}
      </table>
    </td>
  </tr>

  <!-- Price Summary -->
  <tr>
    <td style="padding: 0 20px 20px 20px;">
      <table border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: #ffffff; border-radius: 8px; padding: 15px;">
        <tr>
          <td style="padding: 8px 15px;">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
                  Subtotal
                </td>
                <td align="right" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #1a1a2e;">
                  {{formatCurrency subtotal currency}}
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {{#if fees}}
        <tr>
          <td style="padding: 8px 15px;">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
                  Service fees
                </td>
                <td align="right" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #1a1a2e;">
                  {{formatCurrency fees currency}}
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {{/if}}
        <tr>
          <td style="padding: 12px 15px; border-top: 2px solid #e0e0e0;">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 18px; color: #1a1a2e; font-weight: 700;">
                  Total
                </td>
                <td align="right" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 18px; color: {{primaryColor}}; font-weight: 700;">
                  {{formatCurrency totalAmount currency}}
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<!-- Ticket Card -->
{{> ticket-card
  ticketType=mainTicketType
  festivalName=festivalName
  quantity=totalQuantity
  eventDate=eventDateFormatted
  venueName=venueName
  venueAddress=venueAddress
  orderReference=orderReference
  qrCodeUrl=qrCodeUrl
  lang_fr=false
}}

<!-- CTA Button -->
{{> button
  url=ticketUrl
  text="View my tickets"
  align="center"
  showFallback=true
}}

<!-- Info Box: What's Next -->
{{> info-box
  title="What's next"
  icon="&#128161;"
  content="<ul style='margin: 0; padding-left: 20px;'>
    <li style='margin-bottom: 8px;'>Download your tickets from your personal account</li>
    <li style='margin-bottom: 8px;'>Show the QR code on your phone or printed at the entrance</li>
    <li style='margin-bottom: 8px;'>Activate your cashless account for on-site payments</li>
    <li>Check the lineup and plan your day</li>
  </ul>"
}}

<!-- Event Details -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 25px 0; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
  <tr>
    <td>
      <h3 style="margin: 0 0 15px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; font-weight: 600; color: #1a1a2e;">
        &#128197; Event details
      </h3>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
          <td style="padding: 8px 0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              <strong>Date:</strong> {{eventDateFormatted}}
            </p>
          </td>
        </tr>
        <tr>
          <td style="padding: 8px 0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              <strong>Venue:</strong> {{venueName}}{{#if venueAddress}}, {{venueAddress}}{{/if}}
            </p>
          </td>
        </tr>
        <tr>
          <td style="padding: 8px 0;">
            <p style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #666666;">
              <strong>Payment:</strong> {{paymentMethod}}
            </p>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<p style="margin: 30px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4a4a4a; line-height: 26px;">
  We can't wait to see you there!
</p>

<p style="margin: 20px 0 0 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #1a1a2e; font-weight: 600;">
  The {{festivalName}} Team
</p>
{{/if}}
