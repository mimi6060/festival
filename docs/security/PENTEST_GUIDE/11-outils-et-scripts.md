# 11. Outils et Scripts

## 11.1 Script d'Automatisation

```bash
#!/bin/bash
# pentest_auto.sh - Script automatise de pentest

set -e

TARGET="https://staging-api.festival.io"
OUTPUT_DIR="./pentest_results/$(date +%Y%m%d_%H%M%S)"

mkdir -p "$OUTPUT_DIR"

echo "=== Pentest Automatise Festival Platform ==="
echo "Target: $TARGET"
echo "Output: $OUTPUT_DIR"

# Phase 1: Reconnaissance
echo -e "\n[Phase 1] Reconnaissance"
nmap -sV -sC -oA "$OUTPUT_DIR/nmap" staging-api.festival.io

# Phase 2: SSL/TLS
echo -e "\n[Phase 2] SSL/TLS"
sslscan "$TARGET" > "$OUTPUT_DIR/sslscan.txt"

# Phase 3: Headers
echo -e "\n[Phase 3] Security Headers"
curl -sI "$TARGET/api/health" > "$OUTPUT_DIR/headers.txt"

# Phase 4: API Discovery
echo -e "\n[Phase 4] API Discovery"
curl -s "$TARGET/api/docs-json" > "$OUTPUT_DIR/openapi.json"

# Phase 5: Vulnerability Scan
echo -e "\n[Phase 5] Nuclei Scan"
nuclei -u "$TARGET" -o "$OUTPUT_DIR/nuclei.txt"

# Phase 6: OWASP ZAP
echo -e "\n[Phase 6] OWASP ZAP (baseline)"
docker run -v "$OUTPUT_DIR:/zap/wrk/:rw" -t owasp/zap2docker-stable zap-api-scan.py \
    -t "$TARGET/api/docs-json" -f openapi -r zap_report.html

echo -e "\n=== Scan termine ==="
echo "Resultats dans: $OUTPUT_DIR"
```

## 11.2 Collection Nuclei Custom

```yaml
# nuclei-templates/festival-api.yaml
id: festival-api-security

info:
  name: Festival API Security Checks
  author: Security Team
  severity: medium
  description: Custom security checks for Festival Platform

http:
  - method: POST
    path:
      - '{{BaseURL}}/api/auth/login'
    body: '{"email":"admin@test.com","password":"admin"}'
    matchers:
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: token
        regex:
          - '"accessToken":"([^"]+)"'

  - method: GET
    path:
      - '{{BaseURL}}/api/users'
    headers:
      Authorization: 'Bearer invalid_token'
    matchers:
      - type: status
        status:
          - 200
        negative: true

  - method: POST
    path:
      - '{{BaseURL}}/api/auth/login'
    body: '{"email":"{{injection}}","password":"test"}'
    payloads:
      injection:
        - "' OR '1'='1"
        - "admin'--"
    matchers:
      - type: status
        status:
          - 200
```

---
