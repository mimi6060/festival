# 2. Preparation du Test

## 2.1 Checklist Pre-Test

```bash
# Verifier l'environnement cible
curl -s https://staging-api.festival.io/api/health | jq

# Verifier la documentation API
curl -s https://staging-api.festival.io/api/docs-json | jq '.info'

# Preparer les comptes de test
# Admin:    admin@test.festival.io / TestAdmin123!
# Organizer: organizer@test.festival.io / TestOrg123!
# Staff:    staff@test.festival.io / TestStaff123!
# Cashier:  cashier@test.festival.io / TestCash123!
# Security: security@test.festival.io / TestSec123!
# User:     user@test.festival.io / TestUser123!
```

## 2.2 Configuration Burp Suite

```json
{
  "project_options": {
    "connections": {
      "platform_authentication": {
        "use_user_options": true
      }
    },
    "sessions": {
      "session_handling_rules": [
        {
          "enabled": true,
          "rule_name": "JWT Token Refresh",
          "scope": {
            "include_all_urls": true
          },
          "actions": [
            {
              "action_type": "run_macro",
              "macro_name": "Get JWT Token"
            }
          ]
        }
      ],
      "macros": [
        {
          "name": "Get JWT Token",
          "items": [
            {
              "request": {
                "method": "POST",
                "url": "/api/auth/login",
                "body": "{\"email\":\"user@test.festival.io\",\"password\":\"TestUser123!\"}"
              }
            }
          ]
        }
      ]
    }
  }
}
```

## 2.3 Configuration OWASP ZAP

```yaml
# zap-config.yaml
env:
  contexts:
    - name: 'Festival API'
      urls:
        - 'https://staging-api.festival.io'
      includePaths:
        - 'https://staging-api.festival.io/api/.*'
      excludePaths:
        - 'https://staging-api.festival.io/api/docs.*'
      authentication:
        method: 'json'
        loginUrl: 'https://staging-api.festival.io/api/auth/login'
        loginRequestData: '{"email":"{%username%}","password":"{%password%}"}'
        tokenLocation: 'accessToken'
        tokenExtract: '$.accessToken'
      users:
        - name: 'admin'
          credentials:
            username: 'admin@test.festival.io'
            password: 'TestAdmin123!'
        - name: 'user'
          credentials:
            username: 'user@test.festival.io'
            password: 'TestUser123!'
```

---
