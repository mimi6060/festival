# 8. Tests Mobile

## 8.1 Tests Specifiques Mobile

```python
#!/usr/bin/env python3
"""
mobile_test.py - Tests securite mobile
"""
import requests
import base64
import json

BASE_URL = "https://staging-api.festival.io"

def test_certificate_pinning():
    """Test de certificate pinning"""
    print("\n=== Test Certificate Pinning ===\n")
    print("[INFO] Ce test necessite l'application mobile")
    print("       Utiliser un proxy (Burp/Charles) avec certificat custom")
    print("       Si l'app accepte le certificat, pinning non implemente")

def test_offline_token_storage():
    """Test du stockage securise des tokens"""
    print("\n=== Test Stockage Token ===\n")
    print("[INFO] Verifier sur l'appareil:")
    print("       - iOS: Keychain utilise?")
    print("       - Android: EncryptedSharedPreferences utilise?")
    print("       - Pas de stockage en clair dans AsyncStorage")

def test_api_key_exposure():
    """Test d'exposition des cles API"""
    print("\n=== Test Exposition Cles API ===\n")

    # Verifier les headers de l'app
    # L'app ne doit pas envoyer de cles API sensibles

    headers_to_check = [
        "X-API-Key",
        "Authorization",
        "X-Client-Secret",
    ]

    print("[INFO] Intercepter le trafic mobile et verifier:")
    for header in headers_to_check:
        print(f"       - {header}: valeur sensible?")

def test_deep_link_injection():
    """Test d'injection via deep links"""
    print("\n=== Test Deep Link Injection ===\n")

    malicious_links = [
        "festivalapp://login?token=malicious_token",
        "festivalapp://payment?amount=-100",
        "festivalapp://scan?data=<script>alert(1)</script>",
        "festivalapp://user?id=../../../etc/passwd",
    ]

    print("[INFO] Tester ces deep links sur l'application:")
    for link in malicious_links:
        print(f"       - {link}")

def test_biometric_bypass():
    """Test de bypass biometrique"""
    print("\n=== Test Bypass Biometrique ===\n")
    print("[INFO] Sur appareil roote/jailbreak:")
    print("       - Hooker la fonction de verification biometrique")
    print("       - Verifier si fallback vers PIN securise")
    print("       - Tester avec Frida: frida -U -f com.festival.app -l bypass.js")

def test_root_detection():
    """Test de detection root/jailbreak"""
    print("\n=== Test Detection Root ===\n")
    print("[INFO] Sur appareil roote/jailbreak:")
    print("       - L'app doit detecter et avertir")
    print("       - Fonctionnalites critiques (paiement) bloquees?")
    print("       - Utiliser Magisk Hide / Liberty Lite pour bypass")

if __name__ == "__main__":
    test_certificate_pinning()
    test_offline_token_storage()
    test_api_key_exposure()
    test_deep_link_injection()
    test_biometric_bypass()
    test_root_detection()
```

## 8.2 Checklist Securite Mobile

```markdown
# Checklist Securite Mobile

## Stockage des Donnees

- [ ] Tokens stockes dans Keychain (iOS) / EncryptedSharedPreferences (Android)
- [ ] Pas de donnees sensibles dans AsyncStorage en clair
- [ ] Pas de logs contenant des tokens/passwords
- [ ] Cache HTTP securise ou desactive pour donnees sensibles

## Communication

- [ ] Certificate Pinning implemente
- [ ] TLS 1.2 minimum
- [ ] Pas de donnees sensibles dans les URLs
- [ ] Timeouts configures

## Authentification

- [ ] Biometrie avec fallback securise
- [ ] Session timeout implemente
- [ ] Refresh token stocke securise
- [ ] Logout efface toutes les donnees locales

## Code

- [ ] Obfuscation activee (ProGuard/R8)
- [ ] Pas de cles API en dur
- [ ] Detection root/jailbreak
- [ ] Anti-tampering

## Offline

- [ ] Donnees offline chiffrees
- [ ] Sync securise au retour online
- [ ] Validation des donnees offline
```

---
