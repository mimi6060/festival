# ============================================
# Festival Platform - Staging Overlay
# ============================================
# Staging environment configuration
# Use: kubectl apply -k k8s/overlays/staging/

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: festival-staging

# Base configuration
resources:
  - ../../

# Staging namespace
nameSuffix: -staging

# Common labels for staging
commonLabels:
  environment: staging

# Staging-specific patches
patches:
  # Moderate replicas for staging
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment
      name: api
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment
      name: web
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
    target:
      kind: Deployment
      name: admin

# Staging image tags
images:
  - name: festival/api
    newTag: staging
  - name: festival/web
    newTag: staging
  - name: festival/admin
    newTag: staging

# Staging ConfigMap overrides
configMapGenerator:
  - name: api-config-staging
    behavior: merge
    literals:
      - NODE_ENV=staging
      - LOG_LEVEL=info
