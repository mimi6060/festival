# Redis Sentinel Configuration for Festival Platform
# High Availability Monitoring and Automatic Failover

################################## NETWORK ##################################

# Bind to all interfaces
bind 0.0.0.0

# Sentinel port
port 26379

# Protected mode (disable for Docker networking)
protected-mode no

################################## GENERAL ##################################

# Run as daemon
daemonize no

# PID file
pidfile /var/run/redis/redis-sentinel.pid

# Log file (empty for stdout)
logfile ""

# Working directory
dir /tmp

################################## SENTINEL ##################################

# Master monitoring configuration
# sentinel monitor <master-name> <ip> <port> <quorum>
# The quorum is the number of Sentinels that need to agree about the fact
# the master is not reachable, in order to really mark it as failing.
sentinel monitor festival-master redis-master 6379 2

# Authentication for master and replicas
sentinel auth-pass festival-master ${REDIS_PASSWORD:-Festival2025!Redis}

# Down after milliseconds
# Number of milliseconds the master should be unreachable in order to
# consider it S_DOWN (Subjectively Down) state
sentinel down-after-milliseconds festival-master 5000

# Parallel syncs
# How many replicas we can reconfigure to point to the new replica simultaneously
# during the failover. Use a low number to prevent all replicas from being
# unreachable at the same time during replication sync
sentinel parallel-syncs festival-master 1

# Failover timeout
# - The time needed to restart a failover after a previous failover was
#   already tried against the same master by a given Sentinel, is two times
#   the failover timeout.
# - The time needed for a replica replicating to a wrong master according
#   to a Sentinel current configuration, to be forced to replicate with
#   the right master, is exactly the failover timeout.
# - The time needed to cancel a failover that is already in progress but
#   did not produced any configuration change.
# - The maximum time a failover in progress waits for all the replicas to be
#   reconfigured as replicas of the new master.
sentinel failover-timeout festival-master 60000

# Notification script
# Called when any sentinel event happens (failover, +sdown, -sdown, etc.)
# sentinel notification-script festival-master /etc/redis/notify.sh

# Client reconfiguration script
# Called when the master changes
# sentinel client-reconfig-script festival-master /etc/redis/reconfig.sh

# Deny scripts reconfiguration
sentinel deny-scripts-reconfig yes

# Resolve hostnames
# Enable hostname support. When enabled, Sentinel will resolve hostnames
# and return IP addresses. When disabled, it will return the hostname as
# provided in the configuration.
sentinel resolve-hostnames yes

# Announce hostnames
# When enabled, Sentinel will announce its hostname instead of IP to other
# Sentinels and to clients.
sentinel announce-hostnames yes

################################## SECURITY ##################################

# Sentinel password (Redis 6.2+)
# requirepass ${SENTINEL_PASSWORD:-Festival2025!Sentinel}

# ACL configuration
# aclfile /etc/redis/sentinel-users.acl

################################ KNOWN REPLICAS AND SENTINELS ################################

# These entries are typically auto-generated by Sentinel
# but can be pre-configured for faster discovery

# Known replicas (auto-discovered)
# sentinel known-replica festival-master redis-replica-1 6379
# sentinel known-replica festival-master redis-replica-2 6379

# Known sentinels (auto-discovered)
# sentinel known-sentinel festival-master sentinel-2 26379 <runid>
# sentinel known-sentinel festival-master sentinel-3 26379 <runid>

################################## ADVANCED ##################################

# Announce IP and port (useful for Docker/NAT)
# sentinel announce-ip <ip>
# sentinel announce-port <port>
